{% extends "base.html" %}

{% block style %}
{{ super() }}
<link rel="stylesheet" href="../static/css/bootstrap-slider.min.css">
<style type='text/css'>
</style>
{% endblock %}

{% block body %}
    {{ super() }}
    <div id="recorder">
        <button id="record">Record</button>
        <button id="play">Play</button>
    </div>
    <div id="flash"></div>
{% endblock %}

{% block script %}
{{ super() }}
<script src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<script src="../static/js/recorder.js"></script>
<script>
    // initialize Wami
    Wami.setup({
        id: 'flash' // where to put the flash object
    });

    // initialize some global vars
    var recording = '';
    var recordingUrl = '';
    var playBackUrl = '';

    // get button elements
    var record = $('#record');
    var play = $('#play');

    // define functions
    function startRecording() {
        recording = 'temp.wav';
        recordingUrl = 'http://127.0.0.1:5000/save_file.php?filename=' + recording;
        Wami.startRecording(recordingUrl);
        // update button attributes
        record
            .html('Stop')
            .unbind()
            .click(function() {
                stopRecording();
            });
    }

    function stopRecording() {
        Wami.stopRecording();
        // get the recording for playback
        playBackUrl = 'http://127.0.0:5000/' + recording;
        // update button attributes
        record
            .html('Record')
            .unbind()
            .click(function() {
                startRecording();
            });
    }

    function startPlaying() {
        Wami.startPlaying(playBackUrl);
        // update button attributes
        play
            .html('Stop')
            .unbind()
            .click(function() {
                stopPlaying();
            });
    }

    function stopPlaying() {
        Wami.stopPlaying();
        // update button attributes
        play
            .html('Play')
            .unbind()
            .click(function() {
                startPlaying();
            });
    }

    // add initial click functions
    record.click(function() {
        startRecording();
    });

    play.click(function() {
        startPlaying();
    });
</script>
{% endblock %}
