{% extends "base.html" %}

{% block style %}
{{ super() }}
<style>

    /* Styles for recorder buttons */
    .recorder button, .recorder .upload, .level {
        border: 1px solid #686868;
        height: 30px;
        background-color: white;
        display: inline-block;
        vertical-align: bottom;
        margin: 2px;
        box-sizing: border-box;
        border-radius: 4px;
    }

    /* Styles for level indicator - required! */
    .level {
        width: 30px;
        height: 30px;
        position: relative;
    }
    .progress {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #b10000;
    }
    .upload {
        padding-top: 2px;
    }

</style>

{% endblock %}

{% block body %}
    {{ super() }}
    <div class="container">
        <h1><span class="basic">Basic demo of</span><span class="project-name">FlashWavRecorder</span></h1>
        <section class="recorder-container">

            <!-- Recorder control buttons -->
            <div class="recorder">
                <button class="start-recording" onclick="FWRecorder.record('audio', 'audio.wav');">
                    <img src="/static/images/record.png" alt="Record">
                </button>
                <div class="level">
                    <div class="progress"></div>
                </div>
                <button class="stop-recording" onclick="FWRecorder.stopRecording('audio');">
                    <img src="/static/images/stop.png" alt="Stop Recording"/>
                </button>
                <button class="start-playing" onclick="FWRecorder.playBack('audio');" title="Play">
                    <img src="/static/images/play.png" alt="Play"/>
                </button>
                <div class="upload" style="display: inline-block">
                    <div id="flashcontent">
                        <p>Your browser must have JavaScript enabled and the Adobe Flash Player installed.</p>
                    </div>
                </div>
            </div>

            <!-- Hidden form for easy specifying the upload request parameters -->
            <form id="uploadForm" name="uploadForm" action="../upload.php">
                <input name="authenticity_token" value="xxxxx" type="hidden">
                <input name="upload_file[parent_id]" value="1" type="hidden">
                <input name="format" value="json" type="hidden">
            </form>
        </section>
    </div>
{% endblock %}

{% block script %}
{{ super() }}
<script type="text/javascript" src="/static/js/swfobject.js"></script>
<script type="text/javascript" src="/static/js/recorder.js"></script>
<script type="text/javascript" src="/static/js/basic.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<script src="../static/js/recorder.js"></script>
<script>
    // initialize Wami
    Wami.setup({
        id: 'flash' // where to put the flash object
    });

    // initialize some global vars
    var recording = '';
    var recordingUrl = '';
    var playBackUrl = '';

    // get button elements
    var record = $('#record');
    var play = $('#play');

    // define functions
    function startRecording() {
        recording = 'temp.wav';
        recordingUrl = 'http://127.0.0.1:5000/save_file.php?filename=' + recording;
        Wami.startRecording(recordingUrl);
        // update button attributes
        record
            .html('Stop')
            .unbind()
            .click(function() {
                stopRecording();
            });
    }

    function stopRecording() {
        Wami.stopRecording();
        // get the recording for playback
        playBackUrl = 'http://127.0.0:5000/' + recording;
        // update button attributes
        record
            .html('Record')
            .unbind()
            .click(function() {
                startRecording();
            });
    }

    function startPlaying() {
        Wami.startPlaying(playBackUrl);
        // update button attributes
        play
            .html('Stop')
            .unbind()
            .click(function() {
                stopPlaying();
            });
    }

    function stopPlaying() {
        Wami.stopPlaying();
        // update button attributes
        play
            .html('Play')
            .unbind()
            .click(function() {
                startPlaying();
            });
    }

    // add initial click functions
    record.click(function() {
        startRecording();
    });

    play.click(function() {
        startPlaying();
    });
</script>
{% endblock %}
